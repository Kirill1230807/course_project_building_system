{% extends "core/layout.html" %}
{% load static %}

{% block title %}Матеріали{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'components/modal.css' %}">
    <link rel="stylesheet" href="{% static 'pages/materials/materials.css' %}">
{% endblock %}

{% block content %}
    <h1 class="page-title">Матеріали та постачальники</h1>

    <div class="tabs">
        <button class="tab-button active" data-tab="materials">Матеріали</button>
        <button class="tab-button" data-tab="suppliers">Постачальники</button>
    </div>

    <div id="materials" class="tab-content active">
        {% if current_role in "admin operator" %}
            <button id="openMaterialModal" class="add-btn">Додати матеріал</button>

            <div id="materialModal" class="modal">
                <div class="modal-content">
                    <span class="close" id="closeMaterialModal">&times;</span>
                    <h2 class="modal-title">Новий матеріал</h2>

                    <form method="post" action="{% url 'materials:add' %}">
                        {% csrf_token %}

                        <label>Назва:</label>
                        <input type="text" name="name" required>

                        <label>Опис:</label>
                        <input type="text" name="description">

                        <label>Постачальник:</label>
                        <select name="supplier_id" required>
                            <option value="">-- Оберіть постачальника --</option>
                            {% for id, name in suppliers %}
                                <option value="{{ id }}">{{ name }}</option>
                            {% endfor %}
                        </select>

                        <label>Одиниця вимірювання:</label>
                        <select name="unit_id" required>
                            <option value="">-- Оберіть одиницю --</option>
                            {% for id, name, short in units %}
                                <option value="{{ id }}">{{ name }} ({{ short }})</option>
                            {% endfor %}
                        </select>

                        <label>Ціна:</label>
                        <input type="number" step="0.01" name="price" required>

                        <label>Кількість:</label>
                        <input type="number" step="0.01" name="count" required>

                        <button type="submit" class="btn-save">Зберегти</button>
                    </form>
                </div>
            </div>
        {% endif %}
        <div class="table-wrapper">
            <table class="styled-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Назва</th>
                    <th>Опис</th>
                    <th>Постачальник</th>
                    <th>Одиниця</th>
                    <th>Ціна</th>
                    <th>Кількість</th>
                    {% if current_role in "admin operator" %}
                        <th>Дії</th>
                    {% endif %}
                </tr>
                </thead>

                <tbody>
                {% for m in materials %}
                    <tr>
                        <td>{{ m.id }}</td>
                        <td>{{ m.name }}</td>
                        <td>{{ m.description|default:"--" }}</td>
                        <td>{{ m.supplier }}</td>
                        <td>{{ m.unit }}</td>
                        <td>{{ m.price }}</td>
                        <td>{{ m.count }}</td>
                        {% if current_role in "admin operator" %}
                            <td class="actions-cell">
                                <a href="{% url 'materials:delete' m.id %}"
                                   class="action-delete"
                                   onclick="return confirm('Видалити матеріал?')">
                                    Видалити
                                </a>
                                <span class="actions-separator">|</span>
                                <a href="{% url 'materials:edit' m.id %}" class="action-edit">
                                    Редагувати
                                </a>
                            </td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="8" class="no-data">Немає матеріалів</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="suppliers" class="tab-content">
    {% if current_role in "admin operator" %}
        <button id="openSupplierModal" class="add-btn">Додати постачальника</button>

        <div id="supplierModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeSupplierModal">&times;</span>
                <h2 class="modal-title">Новий постачальник</h2>

                <form method="post" action="{% url 'materials:add_supplier' %}">
                    {% csrf_token %}

                    <label>Назва компанії:</label>
                    <input type="text" name="name" required>

                    <label>Контактна особа:</label>
                    <input type="text" name="contact_name">

                    <label>Телефон:</label>
                    <input type="text" name="phone">

                    <label>Email:</label>
                    <input type="email" name="email">

                    <label>Адреса:</label>
                    <input type="text" name="address">

                    <button type="submit" class="btn-save">Зберегти</button>
                </form>
            </div>
        </div>
    {% endif %}

        <div class="table-wrapper">
            <table class="styled-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Назва компанії</th>
                    <th>Контактна особа</th>
                    <th>Телефон</th>
                    <th>Email</th>
                    <th>Адреса</th>
                    {% if current_role in "admin operator" %}
                        <th>Дії</th>
                    {% endif %}
                </tr>
                </thead>

                <tbody>
                {% for s in suppliers_list %}
                    <tr>
                        <td>{{ s.id }}</td>
                        <td>{{ s.name }}</td>
                        <td>{{ s.contact_name|default:"--" }}</td>
                        <td>{{ s.phone|default:"--" }}</td>
                        <td>{{ s.email|default:"--" }}</td>
                        <td>{{ s.address|default:"--" }}</td>
                        {% if current_role in "admin operator" %}
                            <td class="actions-cell">
                                <a href="{% url 'materials:edit_supplier' s.id %}" class="edit-link">Редагувати</a>
                                <span>|</span>
                                <a href="{% url 'materials:delete_supplier' s.id %}" class="delete-link"
                                   onclick="return confirm('Видалити постачальника?')">Видалити</a>
                            </td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7" class="no-data">Постачальників поки немає</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script src="{% static 'materials/js/materials.js' %}"></script>
{% endblock %}
