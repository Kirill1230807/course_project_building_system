{% extends "core/layout.html" %}
{% load static %}

{% block title %}Матеріали{% endblock %}

{% block content %}
    <h1>Матеріали та постачальники</h1>

    <!-- Вкладки -->
    <div class="tabs">
        <button class="tab-button active" data-tab="materials">Матеріали</button>
        <button class="tab-button" data-tab="suppliers">Постачальники</button>
    </div>

    <!-- ======= Блок з матеріалами ======= -->
    <div id="materials" class="tab-content active">
        <button id="openMaterialModal" class="add-btn">Додати матеріал</button>

        <!-- Модальне вікно для матеріалів -->
        <div id="materialModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeMaterialModal">&times;</span>
                <h2>Новий матеріал</h2>
                <form method="post" action="{% url 'materials:add' %}">
                    {% csrf_token %}
                    <label>Назва:</label>
                    <input type="text" name="name" required><br>

                    <label>Опис:</label>
                    <input type="text" name="description"><br>

                    <label>Постачальник:</label>
                    <select name="supplier_id" required>
                        <option value="">— Оберіть постачальника —</option>
                        {% for id, name in suppliers %}
                            <option value="{{ id }}">{{ name }}</option>
                        {% endfor %}
                    </select><br>

                    <label>Одиниця вимірювання:</label>
                    <select name="unit_id" required>
                        <option value="">— Оберіть одиницю —</option>
                        {% for id, name, short in units %}
                            <option value="{{ id }}">{{ name }} ({{ short }})</option>
                        {% endfor %}
                    </select><br>

                    <label>Ціна:</label>
                    <input type="number" step="0.01" name="price" required><br>

                    <label>Кількість:</label>
                    <input type="number" step="0.01" name="count" required><br>

                    <button type="submit">Зберегти</button>
                </form>
            </div>
        </div>

        <hr>

        <!-- Таблиця матеріалів -->
        <table>
            <tr>
                <th>ID</th>
                <th>Назва</th>
                <th>Опис</th>
                <th>Постачальник</th>
                <th>Одиниця</th>
                <th>Ціна</th>
                <th>Кількість</th>
                <th>Дії</th>
            </tr>
            {% for m in materials %}
                <tr>
                    <td>{{ m.id }}</td>
                    <td>{{ m.name }}</td>
                    <td>{{ m.description|default:"—" }}</td>
                    <td>{{ m.supplier }}</td>
                    <td>{{ m.unit }}</td>
                    <td>{{ m.price }}</td>
                    <td>{{ m.count }}</td>
                    <td><a href="{% url 'materials:delete' m.id %}" onclick="return confirm('Видалити матеріал?')">Видалити</a>
                        |
                        <a href="{% url 'materials:edit' m.id %}">Редагувати</a>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="8">Немає матеріалів</td>
                </tr>
            {% endfor %}
        </table>
    </div>

    <!-- ======= Блок з постачальниками ======= -->
    <div id="suppliers" class="tab-content">
        <button id="openSupplierModal" class="add-btn">Додати постачальника</button>

        <!-- Модальне вікно для постачальників -->
        <div id="supplierModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeSupplierModal">&times;</span>
                <h2>Новий постачальник</h2>
                <form method="post" action="{% url 'materials:add_supplier' %}">
                    {% csrf_token %}
                    <label>Назва компанії:</label>
                    <input type="text" name="name" required><br>

                    <label>Контактна особа:</label>
                    <input type="text" name="contact_name"><br>

                    <label>Телефон:</label>
                    <input type="text" name="phone"><br>

                    <label>Email:</label>
                    <input type="email" name="email"><br>

                    <label>Адреса:</label>
                    <input type="text" name="address"><br>

                    <button type="submit">Зберегти</button>
                </form>
            </div>
        </div>

        <hr>

        <!-- Таблиця постачальників -->
        <table>
            <tr>
                <th>ID</th>
                <th>Назва компанії</th>
                <th>Контактна особа</th>
                <th>Телефон</th>
                <th>Email</th>
                <th>Адреса</th>
                <th>Дії</th>
            </tr>
            {% for s in suppliers_list %}
                <tr>
                    <td>{{ s.id }}</td>
                    <td>{{ s.name }}</td>
                    <td>{{ s.contact_name|default:"—" }}</td>
                    <td>{{ s.phone|default:"—" }}</td>
                    <td>{{ s.email|default:"—" }}</td>
                    <td>{{ s.address|default:"—" }}</td>
                    <td><a href="{% url 'materials:edit_supplier' s.id %}">Редагувати</a> |
                        <a href="{% url 'materials:delete_supplier' s.id %}" onclick="return confirm('Видалити постачальника?')">Видалити</a></td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="7">Постачальників поки немає</td>
                </tr>
            {% endfor %}
        </table>
    </div>

    <link rel="stylesheet" href="{% static 'materials/css/materials.css' %}">
    <script src="{% static 'materials/js/materials.js' %}"></script>
{% endblock %}
