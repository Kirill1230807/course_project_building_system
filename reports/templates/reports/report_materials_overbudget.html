{% extends "core/layout.html" %}
{% load static %}

{% block title %}Перевищення матеріалів{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'pages/reports/overused_materials.css' %}">
{% endblock %}

{% block content %}

<div class="report-container">

    <h1 class="page-title">Звіт: Перевищення матеріалів по кількості</h1>

    <!-- Форма фільтрації -->
    <form method="post" class="filter-form">
        {% csrf_token %}

        <label>Дільниця:</label>
        <select name="section_id">
            <option value="all">Всі дільниці</option>
            {% for s in sections %}
                <option value="{{ s.0 }}" {% if s.0 == selected_section %}selected{% endif %}>
                    {{ s.1 }}
                </option>
            {% endfor %}
        </select>

        <button type="submit" class="filter-btn">Показати</button>
    </form>

    <!-- Таблиця -->
    {% if data %}
        <div class="table-wrapper">
            <table class="styled-table">
                <thead>
                    <tr>
                        <th>Матеріал</th>
                        <th>План (од.)</th>
                        <th>Факт (од.)</th>
                        <th>Перевищення</th>
                        <th>Дільниця</th>
                        <th>Об'єкт</th>
                    </tr>
                </thead>

                <tbody>
                {% for row in data %}
                    <tr class="{% if row.overused_qty > 0 %}overused-row{% endif %}">
                        <td>{{ row.material_name }}</td>
                        <td>{{ row.planned_qty }}</td>
                        <td>{{ row.used_qty }}</td>
                        <td class="overused-cell">
                            {{ row.overused_qty }}
                        </td>
                        <td>{{ row.section_name }}</td>
                        <td>{{ row.site_name }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    {% elif selected_section is not none %}
        <p class="no-data">Перевищень не виявлено.</p>
    {% endif %}

</div>

{% endblock %}
